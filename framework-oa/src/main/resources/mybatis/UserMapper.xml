<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tx.framework.web.modules.sys.dao.UserDao">
	<resultMap id="BaseResultMap" type="User">
		<id column="id" property="id" jdbcType="CHAR" />
		<result column="company_id" property="companyId" jdbcType="CHAR" />
		<result column="office_id" property="officeId" jdbcType="CHAR" />
		<result column="login_name" property="loginName" jdbcType="VARCHAR" />
		<result column="password" property="password" jdbcType="VARCHAR" />
		<result column="salt" property="salt" jdbcType="VARCHAR" />
		<result column="no" property="no" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="email" property="email" jdbcType="VARCHAR" />
		<result column="phone" property="phone" jdbcType="VARCHAR" />
		<result column="mobile" property="mobile" jdbcType="VARCHAR" />
		<result column="user_type" property="userType" jdbcType="CHAR" />
		<result column="login_ip" property="loginIp" jdbcType="VARCHAR" />
		<result column="login_time" property="loginTime" jdbcType="TIMESTAMP" />
		<!-- 
	    <result column="create_by" property="createBy" jdbcType="VARCHAR" />
	    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
	    <result column="update_by" property="updateBy" jdbcType="VARCHAR" />
	    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
	    <result column="remarks" property="remarks" jdbcType="VARCHAR" />
	    <result column="del_flag" property="delFlag" jdbcType="CHAR" />
	     -->
		<collection property="roles" ofType="Role">
			<id property="id" column="r_id" />
			<result property="name" column="r_name" />
		</collection>
	</resultMap>
	
	<sql id="selectSql">
		select
		sys_user.*, sys_role.id as r_id, sys_role.name as r_name
		from
		sys_user
		left join sys_user_role on sys_user.id = sys_user_role.user_id
		left join sys_role on sys_user_role.role_id = sys_role.id 
	</sql>
	
	<!-- 分页查询 -->
	<select id="findUserByPageAndLikeCondition" resultMap="BaseResultMap">
		<include refid="selectSql" />
		<where>
			<if test="para.name != null and para.name != ''">
				and sys_user.name like CONCAT('%',#{para.name},'%')
			</if>
			<if test="para.loginName != null and para.loginName != ''">
				and sys_user.login_name like CONCAT('%',#{para.loginName},'%')
			</if>
		</where>
	</select>

	<!-- 根据id查找用户 -->
	<select id="findUserById" parameterType="String" resultMap="BaseResultMap">
		<include refid="selectSql" />
		where
		sys_user.id=#{id}
	</select>
	
	<!-- 根据登录名查找用户 -->
	<select id="findUserByLoginName" parameterType="String" resultMap="BaseResultMap">
		<include refid="selectSql" />
		where
		sys_user.login_name=#{loginName}
	</select>
</mapper>